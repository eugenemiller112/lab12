---
title: 'Team All Stars Lab 12: Gapminder Permutation Tests'
author: "Johnny Tamanaha, Emily Archambault, Kaiyuan Fan, Eugene Miller, Jingzhi Zhang"
date: "November 15, 2019"
output: html_document
---
## Permutation Testing
```{r, message = FALSE, echo = TRUE, message = FALSE}

perm_mean <- function(perms = 1000, all_values, n_A)
{
  ## Variables ##
  # perms: The number of permutations 
  # all_values (num): all data values
  # n_A (int): Size of group A
  ###############
  
 mu_vec <- numeric(perms)
  
  # Loop throught number of permutations
  for (i in c(1:perms))
  {
    #Creates a randomized vector.
    shuffle <- sample(all_values)
    
    #Creates group A and B vectors
    r_A <- shuffle[1:n_A]
    r_B <- shuffle[(n_A+1):length(all_values)]
    
    #Calculate dealta mu
    delta_mu <- mean(r_A) - mean(r_B)
    
    mu_vec[i] <- delta_mu
    
  }
  
  return(vec)
  
}
```

# Linear Correlation Permuation Test

Say we want to figure out if two variables in a dataset are linearly correlated. For example, is a person's age correlated with a person's income?

Recall that the Pearson correlation coefficient measures the strength of the linear relationship $\rho$ between two random variables, $X$ and $Y$. A correlation close to 1 indicates a strong, positive linear relationship. A correlation close to -1 indicates a strong, negative linear relationship. A correlation close to 0 indicates no linear relationship.

Our null hypothesis is that the variables are not correlated. Our alternative hypothesis is that the variables are correlated.

> **H0:** $\rho = 0$  
**H1:** $\rho \neq 0$

To test our hypothesis, we shuffle the labels on both variables many times. For each iteration, we compute the Pearson linear correlation $\rho$. Make a histogram of all the shuffled correlations. Plot the actual correlation between the variables on the histogram. Reject the null hypothesis if the percentile of the actual correlation is in the critical region.


Implement the following function, perm_cor, to create 1000 iterations of the correlation permuation test. Fill in the function-skeleton to implement the function.

```{r, eval = F}

perm_cor <- function(perms = 1000, x, y)
{
  ## Variables ##
  # perms: The number of permutations 
  # x: Vector of Variable 1 - for computing correlation
  # y: Vector of Variable 2 - for computing correlation
  ###############
  
  # Step 1:
  # Create vector of zeroes of length "perms" to store
  # permuted mean differnces
  
  # Loop throught number of permutations
  for (i in c(1:perms))
  {
    # Step 2:
    # Randomly mix up the values in the vector "y"
    
    # Step 3:
    # Compute the correlation between x and the randomly mixed
    # up y-vector. Store this value in the vector from step 1.
    
  }
  
  # Step 4:
  # Return new updated vector, created in step 1
  
}
```

# Gapminder Questions

Your data science team must come up with two specific questions of interest about the gapminder data set (from 'gapminder' library). 

* Briefly describe the gapminder dataset.

* Explain why your questions are important. One of the questions should be answered with the two-sample mean permutation test, and the other with the correlation permutation test.

* Finish the function skeletons to implement the two-sample permuation test and the correlation permutation test. Run a two-sample mean permutation test. Run a correlation permutation test.

* Create visualizations of the statistical tests.

* Make data-based conclusions about the results. Do you believe there are differences among the groups you are comparing? 

* Generate percentiles, summary statistics (max, min), and probabilites (p-values) to justify your conclusions.

* Summarize each individual's contribution to the lab.

# Format and Order for Team Lab Report

Create a team R Markdown document knitted to html and submitted to OSF. Put your team name in the filename. Make sure your code works on the updated dataset realeased on Friday.